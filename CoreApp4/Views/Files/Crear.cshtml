
@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section head3{

    <link rel="stylesheet" href="~/theme/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
}

@section tail2{
    <script src="~/theme/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/theme/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>

        $(document).ready(function () {
            console.log("Ready!");
            //$('#tabla1').DataTable();
            start();
        });

        function actualizarservs() {
            /*
            vm.servicios([
                { ciudad: 2, servicio: "Tour centro de lima", hotel: 1, pasajeros: 2, nombrePax: "Javier", agencia: 1, tren: "", alm: "", obs: "" },
                { ciudad: 1, servicio: "Tour plaza de armas", hotel: 2, pasajeros: 4, nombrePax: "Carlos", agencia: 1, tren: "", alm: "", obs: "" },
                { ciudad: 3, servicio: "Visita museo", hotel: 3, pasajeros: 3, nombrePax: "Larry", agencia: 2, tren: "", alm: "", obs: "" }
            ]);*/
            console.log("aaaaaaaaaaaaaaaa");
            //ko.applyBindings(vm);
        }

        function start() {
            //dr_mostrarDialogo("contDialogo", "holas", "success");
            //$("#container").html("hi");
            cargarAgencias();
        }

        function Transporte(fecha, ciudad, horaRecojo, horaSalida, vuelo, servicio, pasajeros, nombrePax, vr, agencia, tc, transp, obs) {
            var self = this;
            self.fecha = ko.observable(fecha);
            self.ciudad = ko.observable(ciudad);
            self.horaRecojo = ko.observable(horaRecojo);
            self.horaSalida = ko.observable(horaSalida);
            self.vuelo = ko.observable(vuelo);
            self.servicio = ko.observable(servicio);
            self.pasajeros = ko.observable(pasajeros);
            self.nombrePax = ko.observable(nombrePax);
            self.vr = ko.observable(vr);
            self.agencia = ko.observable(agencia);
            self.tc = ko.observable(tc);
            self.transp = ko.observable(transp);
            self.obs = ko.observable(obs);
        }


        function Servicio(fecha, ciudad, servicio, hotel, pasajeros, nombrePax, agencia, tren, alm, obs) {
            var self = this;
            self.fecha = ko.observable(fecha);
            self.ciudad = ko.observable(ciudad);
            self.servicio = ko.observable(servicio);
            self.hotel = ko.observable(hotel);
            self.pasajeros = ko.observable(pasajeros);
            self.nombrePax = ko.observable(nombrePax);
            self.agencia = ko.observable(agencia);
            self.tren = ko.observable(tren);
            self.alm = ko.observable(alm);
            self.obs = ko.observable(obs);
        }

        function cargarAgencias() {
            var datos;
            $.getJSON("/api/agencias", function (data) {

                $.each(data, function (key, val) {

                    console.log("obj " + key + ".");
                    $.each(val, function (a, b) {
                        console.log(a + ":" + b);
                    });


                });

                console.log("datos recibidos: " + data);
                datos = data;
                vm.ciudades(data);
                /*
                ko.mapping.fromJS(data, {}, vm.ciudades);
                console.log("ciudades: " + vm.ciudades.length);*/
            });
        }

        function FileViewModel() {
            var self = this;
            self.codigo = ko.observable("08023");
            self.biblia = ko.observable("Agosto 2018");
            self.agencia = ko.observable("Golden");

            self.exponer = function () {

                console.log("servicios: " + ko.toJSON(this));
            };

            self.enviar = function () {
                $.ajax({
                    url: 'Crear',
                    cache: false,
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    data: ko.toJSON(this),
                    success: function (data) {
                        console.log(data);
                        dr_mostrarMensajesRespuestaTransaccion("contDialogo", data);
                    },
                    error: function (data) {
                        var rpta = data.responseJSON;
                        console.log(rpta);
                        dr_mostrarMensajesRespuestaTransaccion("contDialogo", rpta);
                    }
                });
            };

            self.servicios = ko.observableArray([
                { fecha : "", ciudad: 2, servicio: "Tour centro de lima", hotel: 1, pasajeros: 2, nombrePax: "Javier", agencia: 1, tren: "", alm: "", obs: "" },
                { fecha: "", ciudad: 1, servicio: "Tour plaza de armas", hotel: 2, pasajeros: 4, nombrePax: "Carlos", agencia: 1, tren: "", alm: "", obs: "" },
                { fecha: "", ciudad: 3, servicio: "Visita museo", hotel: 3, pasajeros: 3, nombrePax: "Larry", agencia: 2, tren: "", alm: "", obs: "" }
            ]);

            self.transportes = ko.observableArray([
                { fecha: "", ciudad: 1, horaRecojo: "19:30", horaSalida: "21:30", vuelo: "LA 2123", servicio: "MIRAMAR / APTO", pasajeros: 2, nombrePax: "", vr: "v", agencia: "Yllari", tc: "", transp: "LIM / CUS", obs: "" }
            ]);

            self.ciudades = ko.observableArray(
                //{ nombre: "Lima", id: 2 },{ nombre: "Cusco", id: 1 },{ nombre: "Arequipa", id: 3 },
            );

            self.agencias = ko.observableArray([
                { nombre: "Golden", id: 1 },
                { nombre: "Continental", id: 2 }
            ]);

            self.hoteles = ko.observableArray([
                { nombre: "Melia", id: 1 },
                { nombre: "Radisson", id: 2 },
                { nombre: "Sheraton", id: 3 }
            ]);

            self.agregarServicio = function () {
                self.servicios.push(
                    { fecha: "", ciudad: 1, servicio: "", hotel: 1, pasajeros: 0, nombrePax: "", agencia: 1, tren: "", alm: "", obs: "" }
                );
            };
            self.quitarServicio = function (serv) {
                self.servicios.remove(serv);
            };
            self.agregarTransporte = function () {
                self.transportes.push(
                    { fecha: "", ciudad: 1, horaRecojo: "0", horaSalida: "00", vuelo: "vuelo", servicio: "", pasajeros: 0, nombrePax: "", vr: "", agencia: "", tc: "", transp: "", obs: "" }
                );
            };
            self.quitarTransporte = function (trans) {
                self.transportes.remove(trans);
            };

        }

        var vm = new FileViewModel();
        ko.applyBindings(vm);

    </script>
}


<h2>Nuevo File</h2>
<div class="row">
    <div class="col-md-12">
        <div class="box box-solid">
            <div class="box-body">
                <div>
                    <label>Codigo</label>
                    <input class="form-control" type="text" data-bind="value: codigo" />
                </div>
                <div>
                    <label>Biblia</label>
                    <select class="form-control" data-bind="value: biblia">
                        <option>Agosto 2018</option>
                        <option>Junio 2018</option>
                    </select>
                </div>
                <div>
                    <label>Agencia</label>
                    <input class="form-control" type="text" data-bind="value: agencia" />
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <h4>Servicios</h4>
        <div class="box box-solid">
            <div class="box-body">
                <table class="table" id="tabla1">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Ciudad</th>
                            <th>Servicio</th>
                            <th>Hotel</th>
                            <th>Pasajeros</th>
                            <th>Nombre Pax.</th>
                            <th>Tren</th>
                            <th>ALM</th>
                            <th>OBS</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: servicios">
                        <tr>
                            <td><input type="date" class="form-control" data-bind="value: fecha" /></td>
                            <td>
                                <select class="form-control" data-bind="options: $root.ciudades,
                                    optionsText: 'nombre',
                                    optionsValue: 'id',
                                    value: ciudad"></select>
                            </td>
                            <td><input class="form-control" data-bind="value: servicio" /></td>
                            <td>
                                <select class="form-control" data-bind="options: $root.hoteles,
                                    optionsText: 'nombre',
                                    optionsValue: 'id',
                                    value: hotel"></select>
                            </td>
                            <td><input class="form-control" type="number" data-bind="value: pasajeros" /></td>
                            <td><input class="form-control" data-bind="value: nombrePax" /></td>

                            <td><input class="form-control" data-bind="value: tren" /></td>
                            <td><input class="form-control" data-bind="value: alm" /></td>
                            <td><input class="form-control" data-bind="value: obs" /></td>
                            <td>
                                <a class="btn btn-default" data-bind="click: $root.quitarServicio">
                                    <i class="fa fa-trash-o"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
            </div>
            <div class="box-footer">
                <button class="btn btn-default" data-bind="click: agregarServicio"><i class="fa fa-plus"></i>&nbsp;&nbsp;&nbsp;Agregar servicio</button>
            </div>
        </div>
    </div>


    <div class="col-md-12">
        <h4>Transportes</h4>
        <div class="box box-solid">
            <div class="box-body">
                <table class="table" id="tabla2">
                    <thead>


                        <tr>
                            <th>Fecha</th>
                            <th>Ciudad</th>
                            <th>Hora recojo</th>
                            <th>Hora salida</th>
                            <th>Vuelo</th>
                            <th>Servicio</th>
                            <th>Pasajeros</th>
                            <th>Nombre Pax.</th>
                            <th>V/R</th>
                            <th>TC</th>
                            <th>Transp.</th>
                            <th>OBS</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: transportes">
                        <tr>
                            <td><input type="date" class="form-control" data-bind="value: fecha" /></td>
                            <td>
                                <select class="form-control" data-bind="options: $root.ciudades,
                                    optionsText: 'nombre',
                                    optionsValue: 'id',
                                    value: ciudad"></select>
                            </td>
                            <td><input type="time" class="form-control" data-bind="value: horaRecojo" /></td>
                            <td><input type="time" class="form-control" data-bind="value: horaSalida" /></td>
                            <td><input class="form-control" data-bind="value: vuelo" /></td>
                            <td><input class="form-control" data-bind="value: servicio" /></td>
                            <td><input class="form-control" data-bind="value: pasajeros" /></td>
                            <td><input class="form-control" data-bind="value: nombrePax" /></td>

                            <td><input class="form-control" data-bind="value: vr" /></td>

                            <td><input class="form-control" data-bind="value: tc" /></td>
                            <td><input class="form-control" data-bind="value: transp" /></td>
                            <td><input class="form-control" data-bind="value: obs" /></td>

                            <td>
                                <a class="btn btn-default" data-bind="click: $root.quitarTransporte">
                                    <i class="fa fa-trash-o"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="box-footer">
                <button class="btn btn-default" data-bind="click: agregarTransporte">
                    <i class="fa fa-plus"></i>&nbsp;&nbsp;&nbsp;Agregar transporte
                </button>
            </div>
        </div>
    </div>


</div>
<div id="contDialogo"></div>
<button class="btn btn-warning pull-right" onclick="cargarAgencias()">Guardar</button>
<button class="btn btn-primary pull-right" data-bind="click: enviar">Guardar</button>
<button class="btn btn-danger pull-right" onclick="actualizarservs()">update</button>
<button class="btn btn-primary" onclick="window.location.href = '/Files' ">Volver</button>
@*<div>
        <a asp-action="Index">@("Volver")</a>
    </div>*@